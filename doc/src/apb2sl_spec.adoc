= Спецификация моста APB - Rx,Tx SL-канала [DRAFT]
===========
:Date:      13.10.2017
:Revision:  0.1
:toc:       right
:icons:     font
:source-highlighter: rouge
:table-caption:     Таблица
:listing-caption:   Код
:chapter-label:     Глава
:toc-title:         Оглавление
:version-label:     Версия
:figure-caption:    Рисунок
:imagesdir:         ./../img/

[[main-description]]
== Описание
Данный проект подразумевает реализацию RTL-описания на языке Verilog одноканального приемопередатчика SL-канала.

[[sl-channel-review]]
== Описание SL-канала
SL - канал - последовательный однонаправленный канал обмена данными, разработанный для внутриплатного и межплатного обмена информацией. Обмен данными типа "точка-с-точкой". Канал состоит из двух линий: линии единиц и линии нулей. Пассивный уровень на линиях - единица. В случае передачи данных каждый разряд кодируется отрицательным импульсом на соответствующей линии. Информация передается словами произвольной разрядности младшими разрядами вперед. Предпоследний разряд - четность. Передатчик вычисляет четность таким образом, чтобы количество импульсов на линии единиц с учетом разряда четности было нечетным, а на линии нулей - четным. Приемник контролирует четность индивидуально по каждой линии. Последним импульсом является синхроимпульс, представляющий собой отрицательные импульсы по обоим линиям одновременно. Синхроимпульс означает, что передача закончена. Не допускается перекрытия информационных импульсов во время передачи.

image::SL.png[title="Временная диаграмма SL-канала", align="center"]

Типичная рабочая частота передатчика, спроектированного в синхронном стиле, составляет от 500кГц до 1МГц. Пауза между информационными битами равна длительности отрицательного импульса.

[[top-level-description]]
== Описание верхнего уровня

[[input-signals]]
=== Входные сигналы
.Общие сигналы
* reset_n - асинхронный общий сигнал сброса
* clk - сигнал тактовой частоты


.APB-связанные сигналы
* pclk - сигнал тактовой частоты
* preset_n -  сигнал сброса
* [9:0]paddr -  шина адреса
* psel1 -  сигнал выбора устройства
* penable -  сигнал разрешения работы
* pwrite -  сигнал выбора чтения или записи
* prdata -  сигнал выбора чтения или записи
* pwdata -  шина записи данных


.SL-связанные сигналы
* inSl0,inSl1 - входная шина SL-канала

[[output-signals]]
=== Выходные сигналы
.SL-связанные сигналы
* outSl0,outSl1 - выходная шина SL-канала
.APB-связанные сигналы
* prdata -  шина чтения данных
* pready -  сигнал готовности к записи
* pslverr - сигнал ошибки

[[signals-frequency-realtions]]
=== Тактирование сигналов

.Указание на источник тактирования входных и выходных сигналов
[cols="3*^", width=99%, options=header]
|===
|Сигнал                 	|Направленность |Клоковый домен
|reset_n          	  		|in             | async
|inSl0    					|in             | async
|inSl1              		|in             | async
|preset_n           	  	|in             | async
|[9:0]paddr            		|in             | pclk
|psel1                 		|in             | pclk
|penable              		|in             | pclk
|pwrite               		|in             | pclk
|[3:0]pstrb					|in             | pclk
|[31:0]pwdata          		|in   		 	| pclk
|[31:0]prdata          		|out   			| pclk
|pslverr					|out 			| pclk
|outSl0 					|out 			| clk
|outSl1						|out 			| clk
|===


[[programm-model]]
== Программная модель
Пользователю для работы доступно три регистра:
. Конфигурационный
. Статусный
. Данных

=== Регистр конфигурации

.Назначение разрядов регистра configReg
[cols="8*^", width=99%]
|===
|0 |1 |2 	|3  	|4 |5 |6    |7    
|OM|BC[2:1] |PCO    |FQ   		|Res* 
|===

.Описание разрядов регистра config_r
. OM - operation mode, режим передатчика(PCE = 0), или приемника(PCE = 0)
. BC - bit count, количество бит в слове, 00->8 бит, 01->16 бит, 10->32 бита
. PCO - parity check off(PCO = 1) - слово с неправильной четностью записывается в регистр данных, или игнорируется(PCO = 0)
. FQ  - frequency, количество бит в слове, 000->0.5 Мгц, 001->1 Мгц, 010->2 Мгц, 011->4 Мгц, 100->4 Мгц

=== Регистр состояния

.Назначение разрядов регистра statusReg
[cols="8*^", width=99%]
|===
|0     |1   |2    |3   |4   |5   |6    |7
|SND   |RCD |PTY  |Res*|Res*|Res*|Res* |Res*
|===

.Описание разрядов регистра status_r
. SND - sended, слово было принято на отправку, и будет полность отправлено через некоторое время
. RCD - received, было принято полное слово
. PTY - parity, результат проверки четности. Если (PTY=0) и (PCO=1), значит четность принятого слова неверна, неверное слово записано в dataReg. Если (PTY=0) и (PCO=0), значит было принято неправильное слово, а в dataReg - последнее правильно принятое сообщение


=== Регистр полученных данных
dataReg[31:0] 
 .Таблица полезного пространства
[cols="2*^", width=99%]
|===
|Значение BC    |Используемые биты   
|00				|dataReg[7:0]
|01				|dataReg[15:0]
|10				|dataReg[31:0]
|===
В неиспользуемой в данный момент части регистра может находиться что угодно.


[[how-to-use]]
== Краткая инструкция по работе с модулем
Для начала работы нужно загрузить в конфигурационный регистр нужную вам конфигурацию.
===Отправка сообщений
Если вы используете модуль в режиме передатчика, то после установки конфигурационного регистра, вам нужно загрузить в регистр данных отправляемое сообщение. После этого вам нужно выставить SND в 0. Далее, необходимо считать содержимое статусного регистра. Как только SND станет равным 1, это будет значить, что сообщение принято к отправке, и вы можете загрузить новое сообщение. 
===Прием сообщений
Если вы используете модуль в режиме приемника, то после установки конфигурационного регистра, в регистр данных будет переписываться последнее принятое сообщение. В частности сразу после установки конфигурационного регистра, в него будет загружено последнее принятое сообщение до этой установки. Загрузив в статусный регистр RCD=0, вы можете ожидать сообщения. Как только выполниться RCD=1, это будет значить, что вы получили сообщение. 